---
title: "Climate Stripes para las 24 regiones de Perú"
author: "Gabriel Carrasco y Antony Barja"
date: "`r Sys.Date()`"
output:
  rmdformats::downcute:
    self_contained: true
    downcute_theme: "default"
---

```{r setup, include=FALSE}
## Global options
knitr::opts_chunk$set(cache = TRUE)
```

```{r ,echo=FALSE, warning=FALSE, message=FALSE}
library(tidyverse)
library(cptcity)
library(plotly)
temp <- read_rds("data/temp")
tidydata <- temp %>%
  pivot_longer(cols = `tmmx1958-01`:`tmmx2020-11`) %>%
  mutate(
    dep = case_when(
      dep == "CALLAO" ~ "LIMA",
      dep != "CALLAO" ~ dep
    )
  ) %>%
  mutate(fecha = substr(name, 5, 8)) %>%
  mutate(
    year = as.integer(substr(fecha, 1, 4)),
    temp = as.double(value)
  ) %>%
  select(dep, year, temp) %>%
  mutate(dep = factor(dep)) %>%
  group_by(dep, year) %>%
  summarise(temp = mean(temp))

temp_ref <- tidydata %>%
  filter(year == 1980) %>%
  select(temp)

names <- tidydata %>% select(dep) %>% unique()
```

### 1. Metodología

> Los valores de temperatura máxima estimado para cada uno de los 24 departamentos del Perú desde el año de 1958 al 2020, fueron calculados mediante estadisticas areales, donde el promedio anual de todos pixeles entrantantes en las respectivas regiones durante los ultimos 62 años fueron consideradas para su estimación, para posteriormente ser gráficados mediante los **Stripes** o **rayas de Ed Hawkins**.
Las Stripes son representaciones visuales donde se evalua la evolución de las  temperaturas medias para cada una de las regiones de interés.

<img src="./workflow.svg" width="100%">

### 2. Datos 

Los valores de temperatura máxima obtenidas durante  los últimos 62 años, fueron adquiridas del conjunto de datos de TerraClimate, un conjunto de datos de clima mensual y balance hídrico climático para superficies terrestres globales, más información [*clic aquí*](https://developers.google.com/earth-engine/datasets/catalog/IDAHO_EPSCOR_TERRACLIMATE#description). 

### 3. Resultados {.tabset}

#### AMAZONAS

```{r ,echo=FALSE,warning=FALSE,message=FALSE, out.width="100%",fig.height=3}
ref <- temp_ref %>% filter(dep == "AMAZONAS") %>%
    select(temp) %>% pull()

data <- tidydata %>% filter(dep == "AMAZONAS") %>%
    mutate(temp = temp)

p1 <- data %>%
    ggplot(aes(x = year,y = 1, fill = temp)) +
    geom_tile() +
    scale_fill_gradientn(
      colors = cpt(pal = "cb_div_RdBu_05",n = 5,rev = T),
      na.value = "transparent"
    ) +
    theme_void() +
    labs(
      subtitle = "(1958-2020)",
      caption = "Source: Elaborado por Pendulum-Lab con datos de TerraClim"
    ) +
    labs(title = "AMAZONAS")

Noax <- list(
  zeroline = FALSE,
  showline = FALSE,
  showticklabels = FALSE,
  showgrid = FALSE
)

ggplotly(p1,tooltip = c("year","temp")) %>% 
  config(displayModeBar = F) %>% 
  layout(xaxis = list(fixedrange = TRUE), yaxis = list(fixedrange = TRUE)) %>% 
  layout(xaxis = Noax, 
         yaxis = Noax)

```


#### ANCASH

```{r ,echo=FALSE,warning=FALSE,message=FALSE, out.width="100%",fig.height=3}
ref <- temp_ref %>% filter(dep == "ANCASH") %>%
    select(temp) %>% pull()

data <- tidydata %>% filter(dep == "ANCASH") %>%
    mutate(temp = temp)

p1 <- data %>%
    ggplot(aes(x = year,y = 1, fill = temp)) +
    geom_tile() +
    scale_fill_gradientn(
      colors = cpt(pal = "cb_div_RdBu_05",n = 5,rev = T),
      na.value = "transparent"
    ) +
    theme_void() +
    labs(
      subtitle = "(1958-2020)",
      caption = "Source: Elaborado por Pendulum-Lab con datos de TerraClim"
    ) +
    labs(title = "ANCASH")
ggplotly(p1,tooltip = c("year","temp")) %>% 
  config(displayModeBar = F) %>% 
  layout(xaxis = list(fixedrange = TRUE), yaxis = list(fixedrange = TRUE)) %>% 
  layout(xaxis = Noax, 
         yaxis = Noax)
```

#### APURIMAC

```{r ,echo=FALSE,warning=FALSE,message=FALSE, out.width="100%",fig.height=3}
ref <- temp_ref %>% filter(dep == "APURIMAC") %>%
    select(temp) %>% pull()

data <- tidydata %>% filter(dep == "APURIMAC") %>%
    mutate(temp = temp)

p1 <- data %>%
    ggplot(aes(x = year,y = 1, fill = temp)) +
    geom_tile() +
    scale_fill_gradientn(
      colors = cpt(pal = "cb_div_RdBu_05",n = 5,rev = T),
      na.value = "transparent"
    ) +
    theme_void() +
    labs(
      subtitle = "(1958-2020)",
      caption = "Source: Elaborado por Pendulum-Lab con datos de TerraClim"
    ) +
    labs(title = "APURIMAC")

ggplotly(p1,tooltip = c("year","temp")) %>% 
  config(displayModeBar = F) %>% 
  layout(xaxis = list(fixedrange = TRUE), yaxis = list(fixedrange = TRUE)) %>% 
  layout(xaxis = Noax, 
         yaxis = Noax)
```

#### AREQUIPA

```{r ,echo=FALSE,warning=FALSE,message=FALSE, out.width="100%",fig.height=3}
ref <- temp_ref %>% filter(dep == "AREQUIPA") %>%
    select(temp) %>% pull()

data <- tidydata %>% filter(dep == "AREQUIPA") %>%
    mutate(temp = temp)

p1 <- data %>%
    ggplot(aes(x = year,y = 1, fill = temp)) +
    geom_tile() +
    scale_fill_gradientn(
      colors = cpt(pal = "cb_div_RdBu_05",n = 5,rev = T),
      na.value = "transparent"
    ) +
    theme_void() +
    labs(
      subtitle = "(1958-2020)",
      caption = "Source: Elaborado por Pendulum-Lab con datos de TerraClim"
    ) +
    labs(title = "AREQUIPA")

ggplotly(p1,tooltip = c("year","temp")) %>% 
  config(displayModeBar = F) %>% 
  layout(xaxis = list(fixedrange = TRUE), yaxis = list(fixedrange = TRUE)) %>% 
  layout(xaxis = Noax, 
         yaxis = Noax)
```

#### AYACUCHO

```{r ,echo=FALSE,warning=FALSE,message=FALSE, out.width="100%",fig.height=3}
ref <- temp_ref %>% filter(dep == "AYACUCHO") %>%
    select(temp) %>% pull()

data <- tidydata %>% filter(dep == "AYACUCHO") %>%
    mutate(temp = temp)

p1 <- data %>%
    ggplot(aes(x = year,y = 1, fill = temp)) +
    geom_tile() +
    scale_fill_gradientn(
      colors = cpt(pal = "cb_div_RdBu_05",n = 5,rev = T),
      na.value = "transparent"
    ) +
    theme_void() +
    labs(
      subtitle = "(1958-2020)",
      caption = "Source: Elaborado por Pendulum-Lab con datos de TerraClim"
    ) +
    labs(title = "AYACUCHO")

ggplotly(p1,tooltip = c("year","temp")) %>% 
  config(displayModeBar = F) %>% 
  layout(xaxis = list(fixedrange = TRUE), yaxis = list(fixedrange = TRUE)) %>% 
  layout(xaxis = Noax, 
         yaxis = Noax)
```

#### CAJAMARCA

```{r ,echo=FALSE,warning=FALSE,message=FALSE, out.width="100%",fig.height=3}
ref <- temp_ref %>% filter(dep == "CAJAMARCA") %>%
    select(temp) %>% pull()

data <- tidydata %>% filter(dep == "CAJAMARCA") %>%
    mutate(temp = temp)

p1 <- data %>%
    ggplot(aes(x = year,y = 1, fill = temp)) +
    geom_tile() +
    scale_fill_gradientn(
      colors = cpt(pal = "cb_div_RdBu_05",n = 5,rev = T),
      na.value = "transparent"
    ) +
    theme_void() +
    labs(
      subtitle = "(1958-2020)",
      caption = "Source: Elaborado por Pendulum-Lab con datos de TerraClim"
    ) +
    labs(title = "CAJAMARCA")

ggplotly(p1,tooltip = c("year","temp")) %>% 
  config(displayModeBar = F) %>% 
  layout(xaxis = list(fixedrange = TRUE), yaxis = list(fixedrange = TRUE)) %>% 
  layout(xaxis = Noax, 
         yaxis = Noax)
```

#### CUSCO

```{r ,echo=FALSE,warning=FALSE,message=FALSE, out.width="100%",fig.height=3}
ref <- temp_ref %>% filter(dep == "CUSCO") %>%
    select(temp) %>% pull()

data <- tidydata %>% filter(dep == "CUSCO") %>%
    mutate(temp = temp)

p1 <- data %>%
    ggplot(aes(x = year,y = 1, fill = temp)) +
    geom_tile() +
    scale_fill_gradientn(
      colors = cpt(pal = "cb_div_RdBu_05",n = 5,rev = T),
      na.value = "transparent"
    ) +
    theme_void() +
    labs(
      subtitle = "(1958-2020)",
      caption = "Source: Elaborado por Pendulum-Lab con datos de TerraClim"
    ) +
    labs(title = "CUSCO")

ggplotly(p1,tooltip = c("year","temp")) %>% 
  config(displayModeBar = F) %>% 
  layout(xaxis = list(fixedrange = TRUE), yaxis = list(fixedrange = TRUE)) %>% 
  layout(xaxis = Noax, 
         yaxis = Noax)
```

#### HUANCAVELICA

```{r ,echo=FALSE,warning=FALSE,message=FALSE, out.width="100%",fig.height=3}
ref <- temp_ref %>% filter(dep == "HUANCAVELICA") %>%
    select(temp) %>% pull()

data <- tidydata %>% filter(dep == "HUANCAVELICA") %>%
    mutate(temp = temp)

p1 <- data %>%
    ggplot(aes(x = year,y = 1, fill = temp)) +
    geom_tile() +
    scale_fill_gradientn(
      colors = cpt(pal = "cb_div_RdBu_05",n = 5,rev = T),
      na.value = "transparent"
    ) +
    theme_void() +
    labs(
      subtitle = "(1958-2020)",
      caption = "Source: Elaborado por Pendulum-Lab con datos de TerraClim"
    ) +
    labs(title = "HUANCAVELICA")

ggplotly(p1,tooltip = c("year","temp")) %>% 
  config(displayModeBar = F) %>% 
  layout(xaxis = list(fixedrange = TRUE), yaxis = list(fixedrange = TRUE)) %>% 
  layout(xaxis = Noax, 
         yaxis = Noax)
```

#### HUANUCO

```{r ,echo=FALSE,warning=FALSE,message=FALSE, out.width="100%",fig.height=3}
ref <- temp_ref %>% filter(dep == "HUANUCO") %>%
    select(temp) %>% pull()

data <- tidydata %>% filter(dep == "HUANUCO") %>%
    mutate(temp = temp)

p1 <- data %>%
    ggplot(aes(x = year,y = 1, fill = temp)) +
    geom_tile() +
    scale_fill_gradientn(
      colors = cpt(pal = "cb_div_RdBu_05",n = 5,rev = T),
      na.value = "transparent"
    ) +
    theme_void() +
    labs(
      subtitle = "(1958-2020)",
      caption = "Source: Elaborado por Pendulum-Lab con datos de TerraClim"
    ) +
    labs(title = "HUANUCO")

ggplotly(p1,tooltip = c("year","temp")) %>% 
  config(displayModeBar = F) %>% 
  layout(xaxis = list(fixedrange = TRUE), yaxis = list(fixedrange = TRUE)) %>% 
  layout(xaxis = Noax, 
         yaxis = Noax)
```

#### ICA

```{r ,echo=FALSE,warning=FALSE,message=FALSE, out.width="100%",fig.height=3}
ref <- temp_ref %>% filter(dep == "ICA") %>%
    select(temp) %>% pull()

data <- tidydata %>% filter(dep == "ICA") %>%
    mutate(temp = temp)

p1 <- data %>%
    ggplot(aes(x = year,y = 1, fill = temp)) +
    geom_tile() +
    scale_fill_gradientn(
      colors = cpt(pal = "cb_div_RdBu_05",n = 5,rev = T),
      na.value = "transparent"
    ) +
    theme_void() +
    labs(
      subtitle = "(1958-2020)",
      caption = "Source: Elaborado por Pendulum-Lab con datos de TerraClim"
    ) +
    labs(title = "ICA")

ggplotly(p1,tooltip = c("year","temp")) %>% 
  config(displayModeBar = F) %>% 
  layout(xaxis = list(fixedrange = TRUE), yaxis = list(fixedrange = TRUE)) %>% 
  layout(xaxis = Noax, 
         yaxis = Noax)
```

#### JUNIN

```{r ,echo=FALSE,warning=FALSE,message=FALSE, out.width="100%",fig.height=3}
ref <- temp_ref %>% filter(dep == "JUNIN") %>%
    select(temp) %>% pull()

data <- tidydata %>% filter(dep == "JUNIN") %>%
    mutate(temp = temp)

p1 <- data %>%
    ggplot(aes(x = year,y = 1, fill = temp)) +
    geom_tile() +
    scale_fill_gradientn(
      colors = cpt(pal = "cb_div_RdBu_05",n = 5,rev = T),
      na.value = "transparent"
    ) +
    theme_void() +
    labs(
      subtitle = "(1958-2020)",
      caption = "Source: Elaborado por Pendulum-Lab con datos de TerraClim"
    ) +
    labs(title = "JUNIN")

ggplotly(p1,tooltip = c("year","temp")) %>% 
  config(displayModeBar = F) %>% 
  layout(xaxis = list(fixedrange = TRUE), yaxis = list(fixedrange = TRUE)) %>% 
  layout(xaxis = Noax, 
         yaxis = Noax)
```

#### LA LIBERTAD

```{r ,echo=FALSE,warning=FALSE,message=FALSE, out.width="100%",fig.height=3}
ref <- temp_ref %>% filter(dep == "LA LIBERTAD") %>%
    select(temp) %>% pull()

data <- tidydata %>% filter(dep == "LA LIBERTAD") %>%
    mutate(temp = temp)

p1 <- data %>%
    ggplot(aes(x = year,y = 1, fill = temp)) +
    geom_tile() +
    scale_fill_gradientn(
      colors = cpt(pal = "cb_div_RdBu_05",n = 5,rev = T),
      na.value = "transparent"
    ) +
    theme_void() +
    labs(
      subtitle = "(1958-2020)",
      caption = "Source: Elaborado por Pendulum-Lab con datos de TerraClim"
    ) +
    labs(title = "LA LIBERTAD")

ggplotly(p1,tooltip = c("year","temp")) %>% 
  config(displayModeBar = F) %>% 
  layout(xaxis = list(fixedrange = TRUE), yaxis = list(fixedrange = TRUE)) %>% 
  layout(xaxis = Noax, 
         yaxis = Noax)
```


#### LAMBAYEQUE

```{r ,echo=FALSE,warning=FALSE,message=FALSE, out.width="100%",fig.height=3}
ref <- temp_ref %>% filter(dep == "LAMBAYEQUE") %>%
    select(temp) %>% pull()

data <- tidydata %>% filter(dep == "LAMBAYEQUE") %>%
    mutate(temp = temp)

p1 <- data %>%
    ggplot(aes(x = year,y = 1, fill = temp)) +
    geom_tile() +
    scale_fill_gradientn(
      colors = cpt(pal = "cb_div_RdBu_05",n = 5,rev = T),
      na.value = "transparent"
    ) +
    theme_void() +
    labs(
      subtitle = "(1958-2020)",
      caption = "Source: Elaborado por Pendulum-Lab con datos de TerraClim"
    ) +
    labs(title = "LAMBAYEQUE")

ggplotly(p1,tooltip = c("year","temp")) %>% 
  config(displayModeBar = F) %>% 
  layout(xaxis = list(fixedrange = TRUE), yaxis = list(fixedrange = TRUE)) %>% 
  layout(xaxis = Noax, 
         yaxis = Noax)
```


#### LIMA

```{r ,echo=FALSE,warning=FALSE,message=FALSE, out.width="100%",fig.height=3}
ref <- temp_ref %>% filter(dep == "LIMA") %>%
    select(temp) %>% pull()

data <- tidydata %>% filter(dep == "LIMA") %>%
    mutate(temp = temp)

p1 <- data %>%
    ggplot(aes(x = year,y = 1, fill = temp)) +
    geom_tile() +
    scale_fill_gradientn(
      colors = cpt(pal = "cb_div_RdBu_05",n = 5,rev = T),
      na.value = "transparent"
    ) +
    theme_void() +
    labs(
      subtitle = "(1958-2020)",
      caption = "Source: Elaborado por Pendulum-Lab con datos de TerraClim"
    ) +
    labs(title = "LIMA")

ggplotly(p1,tooltip = c("year","temp")) %>% 
  config(displayModeBar = F) %>% 
  layout(xaxis = list(fixedrange = TRUE), yaxis = list(fixedrange = TRUE)) %>% 
  layout(xaxis = Noax, 
         yaxis = Noax)
```

#### LORETO

```{r ,echo=FALSE,warning=FALSE,message=FALSE, out.width="100%",fig.height=3}
ref <- temp_ref %>% filter(dep == "LORETO") %>%
    select(temp) %>% pull()

data <- tidydata %>% filter(dep == "LORETO") %>%
    mutate(temp = temp)

p1 <- data %>%
    ggplot(aes(x = year,y = 1, fill = temp)) +
    geom_tile() +
    scale_fill_gradientn(
      colors = cpt(pal = "cb_div_RdBu_05",n = 5,rev = T),
      na.value = "transparent"
    ) +
    theme_void() +
    labs(
      subtitle = "(1958-2020)",
      caption = "Source: Elaborado por Pendulum-Lab con datos de TerraClim"
    ) +
    labs(title = "LORETO")

ggplotly(p1,tooltip = c("year","temp")) %>% 
  config(displayModeBar = F) %>% 
  layout(xaxis = list(fixedrange = TRUE), yaxis = list(fixedrange = TRUE)) %>% 
  layout(xaxis = Noax, 
         yaxis = Noax)
```

#### MADRE DE DIOS

```{r ,echo=FALSE,warning=FALSE,message=FALSE, out.width="100%",fig.height=3}
ref <- temp_ref %>% filter(dep == "MADRE DE DIOS") %>%
    select(temp) %>% pull()

data <- tidydata %>% filter(dep == "MADRE DE DIOS") %>%
    mutate(temp = temp)

p1 <- data %>%
    ggplot(aes(x = year,y = 1, fill = temp)) +
    geom_tile() +
    scale_fill_gradientn(
      colors = cpt(pal = "cb_div_RdBu_05",n = 5,rev = T),
      na.value = "transparent"
    ) +
    theme_void() +
    labs(
      subtitle = "(1958-2020)",
      caption = "Source: Elaborado por Pendulum-Lab con datos de TerraClim"
    ) +
    labs(title = "MADRE DE DIOS")

ggplotly(p1,tooltip = c("year","temp")) %>% 
  config(displayModeBar = F) %>% 
  layout(xaxis = list(fixedrange = TRUE), yaxis = list(fixedrange = TRUE)) %>% 
  layout(xaxis = Noax, 
         yaxis = Noax)
```

#### MOQUEGUA

```{r ,echo=FALSE,warning=FALSE,message=FALSE, out.width="100%",fig.height=3}
ref <- temp_ref %>% filter(dep == "MOQUEGUA") %>%
    select(temp) %>% pull()

data <- tidydata %>% filter(dep == "MOQUEGUA") %>%
    mutate(temp = temp)

p1 <- data %>%
    ggplot(aes(x = year,y = 1, fill = temp)) +
    geom_tile() +
    scale_fill_gradientn(
      colors = cpt(pal = "cb_div_RdBu_05",n = 5,rev = T),
      na.value = "transparent"
    ) +
    theme_void() +
    labs(
      subtitle = "(1958-2020)",
      caption = "Source: Elaborado por Pendulum-Lab con datos de TerraClim"
    ) +
    labs(title = "MOQUEGUA")

ggplotly(p1,tooltip = c("year","temp")) %>% 
  config(displayModeBar = F) %>% 
  layout(xaxis = list(fixedrange = TRUE), yaxis = list(fixedrange = TRUE)) %>% 
  layout(xaxis = Noax, 
         yaxis = Noax)
```

#### PASCO

```{r ,echo=FALSE,warning=FALSE,message=FALSE, out.width="100%",fig.height=3}
ref <- temp_ref %>% filter(dep == "PASCO") %>%
    select(temp) %>% pull()

data <- tidydata %>% filter(dep == "PASCO") %>%
    mutate(temp = temp)

p1 <- data %>%
    ggplot(aes(x = year,y = 1, fill = temp)) +
    geom_tile() +
    scale_fill_gradientn(
      colors = cpt(pal = "cb_div_RdBu_05",n = 5,rev = T),
      na.value = "transparent"
    ) +
    theme_void() +
    labs(
      subtitle = "(1958-2020)",
      caption = "Source: Elaborado por Pendulum-Lab con datos de TerraClim"
    ) +
    labs(title = "PASCO")

ggplotly(p1,tooltip = c("year","temp")) %>% 
  config(displayModeBar = F) %>% 
  layout(xaxis = list(fixedrange = TRUE), yaxis = list(fixedrange = TRUE)) %>% 
  layout(xaxis = Noax, 
         yaxis = Noax)
```

#### PIURA

```{r ,echo=FALSE,warning=FALSE,message=FALSE, out.width="100%",fig.height=3}
ref <- temp_ref %>% filter(dep == "PIURA") %>%
    select(temp) %>% pull()

data <- tidydata %>% filter(dep == "PIURA") %>%
    mutate(temp = temp)

p1 <- data %>%
    ggplot(aes(x = year,y = 1, fill = temp)) +
    geom_tile() +
    scale_fill_gradientn(
      colors = cpt(pal = "cb_div_RdBu_05",n = 5,rev = T),
      na.value = "transparent"
    ) +
    theme_void() +
    labs(
      subtitle = "(1958-2020)",
      caption = "Source: Elaborado por Pendulum-Lab con datos de TerraClim"
    ) +
    labs(title = "PIURA")

ggplotly(p1,tooltip = c("year","temp")) %>% 
  config(displayModeBar = F) %>% 
  layout(xaxis = list(fixedrange = TRUE), yaxis = list(fixedrange = TRUE)) %>% 
  layout(xaxis = Noax, 
         yaxis = Noax)
```

#### PUNO

```{r ,echo=FALSE,warning=FALSE,message=FALSE, out.width="100%",fig.height=3}
ref <- temp_ref %>% filter(dep == "PUNO") %>%
    select(temp) %>% pull()

data <- tidydata %>% filter(dep == "PUNO") %>%
    mutate(temp = temp)

p1 <- data %>%
    ggplot(aes(x = year,y = 1, fill = temp)) +
    geom_tile() +
    scale_fill_gradientn(
      colors = cpt(pal = "cb_div_RdBu_05",n = 5,rev = T),
      na.value = "transparent"
    ) +
    theme_void() +
    labs(
      subtitle = "(1958-2020)",
      caption = "Source: Elaborado por Pendulum-Lab con datos de TerraClim"
    ) +
    labs(title = "PUNO")

ggplotly(p1,tooltip = c("year","temp")) %>% 
  config(displayModeBar = F) %>% 
  layout(xaxis = list(fixedrange = TRUE), yaxis = list(fixedrange = TRUE)) %>% 
  layout(xaxis = Noax, 
         yaxis = Noax)
```


#### SAN MARTIN

```{r ,echo=FALSE,warning=FALSE,message=FALSE, out.width="100%",fig.height=3}
ref <- temp_ref %>% filter(dep == "SAN MARTIN") %>%
    select(temp) %>% pull()

data <- tidydata %>% filter(dep == "SAN MARTIN") %>%
    mutate(temp = temp)

p1 <- data %>%
    ggplot(aes(x = year,y = 1, fill = temp)) +
    geom_tile() +
    scale_fill_gradientn(
      colors = cpt(pal = "cb_div_RdBu_05",n = 5,rev = T),
      na.value = "transparent"
    ) +
    theme_void() +
    labs(
      subtitle = "(1958-2020)",
      caption = "Source: Elaborado por Pendulum-Lab con datos de TerraClim"
    ) +
    labs(title = "SAN MARTIN")

ggplotly(p1,tooltip = c("year","temp")) %>% 
  config(displayModeBar = F) %>% 
  layout(xaxis = list(fixedrange = TRUE), yaxis = list(fixedrange = TRUE)) %>% 
  layout(xaxis = Noax, 
         yaxis = Noax)
```

#### TACNA

```{r ,echo=FALSE,warning=FALSE,message=FALSE, out.width="100%",fig.height=3}
ref <- temp_ref %>% filter(dep == "TACNA") %>%
    select(temp) %>% pull()

data <- tidydata %>% filter(dep == "TACNA") %>%
    mutate(temp = temp)

p1 <- data %>%
    ggplot(aes(x = year,y = 1, fill = temp)) +
    geom_tile() +
    scale_fill_gradientn(
      colors = cpt(pal = "cb_div_RdBu_05",n = 5,rev = T),
      na.value = "transparent"
    ) +
    theme_void() +
    labs(
      subtitle = "(1958-2020)",
      caption = "Source: Elaborado por Pendulum-Lab con datos de TerraClim"
    ) +
    labs(title = "TACNA")

ggplotly(p1,tooltip = c("year","temp")) %>% 
  config(displayModeBar = F) %>% 
  layout(xaxis = list(fixedrange = TRUE), yaxis = list(fixedrange = TRUE)) %>% 
  layout(xaxis = Noax, 
         yaxis = Noax)
```

#### TUMBES

```{r ,echo=FALSE,warning=FALSE,message=FALSE, out.width="100%",fig.height=3}
ref <- temp_ref %>% filter(dep == "TUMBES") %>%
    select(temp) %>% pull()

data <- tidydata %>% filter(dep == "TUMBES") %>%
    mutate(temp = temp)

p1 <- data %>%
    ggplot(aes(x = year,y = 1, fill = temp)) +
    geom_tile() +
    scale_fill_gradientn(
      colors = cpt(pal = "cb_div_RdBu_05",n = 5,rev = T),
      na.value = "transparent"
    ) +
    theme_void() +
    labs(
      subtitle = "(1958-2020)",
      caption = "Source: Elaborado por Pendulum-Lab con datos de TerraClim"
    ) +
    labs(title = "TUMBES")

ggplotly(p1,tooltip = c("year","temp")) %>% 
  config(displayModeBar = F) %>% 
  layout(xaxis = list(fixedrange = TRUE), yaxis = list(fixedrange = TRUE)) %>% 
  layout(xaxis = Noax, 
         yaxis = Noax)
```

#### UCAYALI

```{r ,echo=FALSE,warning=FALSE,message=FALSE, out.width="100%",fig.height=3}
ref <- temp_ref %>% filter(dep == "UCAYALI") %>%
    select(temp) %>% pull()

data <- tidydata %>% filter(dep == "UCAYALI") %>%
    mutate(temp = temp)

p1 <- data %>%
    ggplot(aes(x = year,y = 1, fill = temp)) +
    geom_tile() +
    scale_fill_gradientn(
      colors = cpt(pal = "cb_div_RdBu_05",n = 5,rev = T),
      na.value = "transparent"
    ) +
    theme_void() +
    labs(
      subtitle = "(1958-2020)",
      caption = "Source: Elaborado por Pendulum-Lab con datos de TerraClim"
    ) +
    labs(title = "UCAYALI")

ggplotly(p1,tooltip = c("year","temp")) %>% 
  config(displayModeBar = F) %>% 
  layout(xaxis = list(fixedrange = TRUE), yaxis = list(fixedrange = TRUE)) %>% 
  layout(xaxis = Noax, 
         yaxis = Noax)
```






